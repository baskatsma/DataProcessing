<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="index.css">
<body>
<textarea id="abbrev">
# date, maxtemp
</textarea>
<br></br>
<textarea id="rawdata">
20170101,    5
20170102,   30
20170103,   50
20170104,   58
20170105,    0
20170106,  -30
20170107,   -2
20170108,   43
20170109,   48
20170110,   53
20170111,   72
20170112,   52
20170113,   31
20170114,   18
20170115,    7
20170116,  -16
20170117,  -34
20170118,  -38
20170119,  -20
20170120,   -3
20170121,   -2
20170122,  -17
20170123,   16
20170124,    8
20170125,  -11
20170126,  -28
20170127,    8
20170128,   54
20170129,   47
20170130,   49
20170131,   37
20170201,   34
20170202,   86
20170203,   86
20170204,   57
20170205,   44
20170206,   43
20170207,   24
20170208,    0
20170209,  -16
20170210,  -23
20170211,   -4
20170212,    7
20170213,   22
20170214,   38
20170215,   74
20170216,   68
20170217,   70
20170218,   56
20170219,   62
20170220,   91
20170221,   96
20170222,   95
20170223,   80
20170224,   45
20170225,   58
20170226,   87
20170227,   87
20170228,   47
20170301,   63
20170302,   66
20170303,   59
20170304,   92
20170305,   69
20170306,   60
20170307,   67
20170308,   59
20170309,   77
20170310,   65
20170311,   73
20170312,   79
20170313,   65
20170314,   88
20170315,   90
20170316,   94
20170317,   83
20170318,   97
20170319,  113
20170320,  103
20170321,   75
20170322,   63
20170323,   82
20170324,   84
20170325,   85
20170326,   80
20170327,   92
20170328,  113
20170329,  126
20170330,  157
20170331,  145
20170401,  108
20170402,  103
20170403,   81
20170404,   98
20170405,   92
20170406,   81
20170407,  105
20170408,   96
20170409,  117
20170410,   98
20170411,   96
20170412,   98
20170413,   93
20170414,   99
20170415,   96
20170416,   79
20170417,   65
20170418,   61
20170419,   39
20170420,   69
20170421,  111
20170422,   78
20170423,   66
20170424,   93
20170425,   59
20170426,   50
20170427,   61
20170428,   76
20170429,   76
20170430,  123
20170501,  117
20170502,  100
20170503,  107
20170504,  104
20170505,   89
20170506,  128
20170507,  117
20170508,   97
20170509,   80
20170510,   90
20170511,  154
20170512,  155
20170513,  140
20170514,  134
20170515,  149
20170516,  204
20170517,  223
20170518,  165
20170519,  136
20170520,  125
20170521,  144
20170522,  176
20170523,  161
20170524,  159
20170525,  174
20170526,  203
20170527,  229
20170528,  205
20170529,  219
20170530,  183
20170531,  174
20170601,  166
20170602,  198
20170603,  184
20170604,  154
20170605,  171
20170606,  141
20170607,  140
20170608,  168
20170609,  165
20170610,  178
20170611,  199
20170612,  161
20170613,  163
20170614,  174
20170615,  200
20170616,  162
20170617,  186
20170618,  208
20170619,  236
20170620,  216
20170621,  214
20170622,  229
20170623,  196
20170624,  171
20170625,  175
20170626,  168
20170627,  173
20170628,  180
20170629,  175
20170630,  162
20170701,  161
20170702,  156
20170703,  166
20170704,  186
20170705,  190
20170706,  199
20170707,  206
20170708,  186
20170709,  172
20170710,  196
20170711,  177
20170712,  149
20170713,  146
20170714,  142
20170715,  172
20170716,  186
20170717,  186
20170718,  199
20170719,  235
20170720,  191
20170721,  182
20170722,  194
20170723,  160
20170724,  161
20170725,  167
20170726,  190
20170727,  185
20170728,  172
20170729,  182
20170730,  188
20170731,  181
20170801,  178
20170802,  176
20170803,  190
20170804,  183
20170805,  159
20170806,  158
20170807,  168
20170808,  162
20170809,  167
20170810,  157
20170811,  167
20170812,  168
20170813,  162
20170814,  179
20170815,  179
20170816,  176
20170817,  173
20170818,  169
20170819,  154
20170820,  158
20170821,  159
20170822,  182
20170823,  196
20170824,  179
20170825,  169
20170826,  182
20170827,  178
20170828,  187
20170829,  210
20170830,  178
20170831,  144
20170901,  147
20170902,  133
20170903,  130
20170904,  158
20170905,  186
20170906,  159
20170907,  156
20170908,  151
20170909,  132
20170910,  139
20170911,  141
20170912,  146
20170913,  141
20170914,  117
20170915,  125
20170916,  106
20170917,  108
20170918,  120
20170919,  120
20170920,  135
20170921,  134
20170922,  119
20170923,  109
20170924,  121
20170925,  142
20170926,  132
20170927,  136
20170928,  158
20170929,  171
20170930,  131
20171001,  141
20171002,  156
20171003,  136
20171004,  130
20171005,  129
20171006,  116
20171007,  122
20171008,  121
20171009,  121
20171010,  143
20171011,  148
20171012,  134
20171013,  153
20171014,  148
20171015,  158
20171016,  186
20171017,  129
20171018,  137
20171019,  157
20171020,  137
20171021,  132
20171022,  108
20171023,  126
20171024,  153
20171025,  142
20171026,  140
20171027,  118
20171028,  124
20171029,  107
20171030,   83
20171031,  101
20171101,  112
20171102,   98
20171103,   88
20171104,  106
20171105,   78
20171106,   48
20171107,   33
20171108,   59
20171109,   87
20171110,   92
20171111,   66
20171112,   52
20171113,   62
20171114,   77
20171115,   94
20171116,   93
20171117,   56
20171118,   69
20171119,   67
20171120,   78
20171121,  115
20171122,  114
20171123,  111
20171124,   69
20171125,   37
20171126,   53
20171127,   67
20171128,   54
20171129,   29
20171130,   15
20171201,    0
20171202,   -4
20171203,   37
20171204,   70
20171205,   76
20171206,   80
20171207,   59
20171208,   26
20171209,   21
20171210,   11
20171211,   -1
20171212,   18
20171213,   40
20171214,   33
20171215,   26
20171216,   27
20171217,   25
20171218,   59
20171219,   52
20171220,   75
20171221,   84
20171222,   86
20171223,   87
20171224,   82
20171225,   74
20171226,   58
20171227,   51
20171228,   39
20171229,   28
20171230,   88
20171231,  106
20180101,   68
</textarea>
<br></br>
<div id="title">
Temperatures in De Bilt (Netherlands) throughout 2016
</div>
<canvas id="xLines" width="10" height="300"></canvas>
<canvas id="xText" width="50" height="300"></canvas>
<canvas id="avgTempPerDay" width="600" height="300"></canvas>
<canvas id="yLines" width="585" height="10"></canvas>
<canvas id="yText" width="615" height="50"></canvas>
<script>
// Remove all whitespace from rawdata and split at enters
var yearlyData = [];
yearlyData = document.getElementById("rawdata").value.toString();
var yearlyDataCleaned = yearlyData.split(' ').join('');
var yearlyDataSplitted = yearlyDataCleaned.split("\n");

// Create array containing only the dates
var dateLength = 8;
var dateOnly = [];
for (var day in yearlyDataSplitted) {
  if (day <= 365) { // Fix weird array length (367 entries)
    dateOnly.push(yearlyDataSplitted[day].substring(0, dateLength));
  }
}

// Create array containing only the temperatures
var maxTempLength = 3;
var tempOnly = [];
for (var temp in yearlyDataSplitted) {
  if (temp <= 365) { // Fix weird array length (367 entries)
    tempOnly.push(yearlyDataSplitted[temp].substring(9, 9 + maxTempLength)); // Temperatures values start after 9 characters
  }
}

// Convert dateString to valid JavaScript date
var fixedDateOnly = [];
for (var dateString in dateOnly) {
  var year = dateOnly[dateString].substring(0, 4); // First 4 char are YYYY
  var month = dateOnly[dateString].substring(4, 6); // Next 2 are MM
  var day = dateOnly[dateString].substring(6, 8); // Last 2 are DD
  var date = new Date(year, month-1, day);
  fixedDateOnly.push(date);
}

// Convert numbers to valid JavaScript numbers
var fixedTempOnly = [];
for (var number in tempOnly) {
  var number = Number(tempOnly[number]);
  fixedTempOnly.push(number);
}

console.log(fixedTempOnly);

// Create new list with .getTime() output to use for transformations
var calculationsDate = [];
for (var date in fixedDateOnly) {
  var newDateInMilliseconds = fixedDateOnly[date].getTime();
  var millisecondsSinceEpochToStartDataSet = 1483225200000;
  var newDateInDays = ((newDateInMilliseconds - millisecondsSinceEpochToStartDataSet) + 86400000) / 86400000;
  var roundedNewDateInDays = Math.round(newDateInDays);
  calculationsDate.push(roundedNewDateInDays);
}

// Find min and max of date and temperatures
var maxDate = Math.max.apply(null, calculationsDate);
var minDate = Math.min.apply(null, calculationsDate);
var maxTemp = Math.max.apply(null, fixedTempOnly);
var minTemp = Math.min.apply(null, fixedTempOnly);

// Create multiple canvasses to quickly add elements to the plot
var ctx = document.getElementById('avgTempPerDay').getContext('2d');
var ctXLines = document.getElementById('xLines').getContext('2d');
var ctYLines = document.getElementById('yLines').getContext('2d');
var ctXText = document.getElementById('xText').getContext('2d');
var ctYText = document.getElementById('yText').getContext('2d');

function createTransform(domain, range){
	// domain is a two-element array of the data bounds [domain_min, domain_max]
	// range is a two-element array of the screen bounds [range_min, range_max]
	// this gives you two equations to solve:
	// range_min = alpha * domain_min + beta
	// range_max = alpha * domain_max + beta
 		// a solution would be:

    var domain_min = domain[0]
    var domain_max = domain[1]
    var range_min = range[0]
    var range_max = range[1]

    // formulas to calculate the alpha and the beta
   	var alpha = (range_max - range_min) / (domain_max - domain_min)
    var beta = range_max - alpha * domain_max

    // returns the function for the linear transformation (y= a * x + b)
    return function(x){
      return alpha * x + beta;
    }
}

var dateRange = [minDate, maxDate];
var tempRange = [minTemp, maxTemp];
var xRange = [585, 0];
var yRange = [300, 0];

xScale = createTransform(dateRange, xRange);
yScale = createTransform(tempRange, yRange);
var xScaled = [];
var yScaled = [];

for (var date in calculationsDate) {
  var transformedDate = Math.round(xScale(calculationsDate[date]));
  xScaled.push(transformedDate);
}

for (var temperature in fixedTempOnly) {
  var transformedTemperature = yScale(fixedTempOnly[temperature]);
  yScaled.push(transformedTemperature);
}

// Define measurements
var canvasWidth = 600;
var canvasHeight = 300;
var canvasWidthXLines = 20;
var canvasWidthXText = 50;
var canvasHeightXLines = 300;
var canvasHeightXText = 335;
var canvasWidthYLines = 585;
var canvasWidthYText = 615;
var canvasHeightYLines = 20;
var canvasHeightYText = 50;

// Draw data points into a line graph
var year = 366;
ctx.beginPath();
for (i = 0; i <= year; i++) {
  ctx.strokeStyle = 'black';
  ctx.lineWidth=0.05;
  ctx.moveTo(15 + xScaled[i], yScaled[i]);
  ctx.lineTo(15 + xScaled[i+1], yScaled[i+1]);
  ctx.stroke();
}
ctx.closePath();

// Draw Y-axis
ctx.beginPath();
ctx.strokeStyle = 'black';
ctx.lineWidth=2;
ctx.moveTo(15, canvasHeight);
ctx.lineTo((canvasWidth), canvasHeight);
ctx.stroke();
ctx.closePath();

// Draw X-axis
ctx.beginPath();
ctx.strokeStyle = 'black';
ctx.lineWidth=2;
ctx.moveTo(0, canvasHeight);
ctx.lineTo(0, 0);
ctx.stroke();
ctx.closePath();

// Draw Y-axis lines
var stepsY = 6;
ctXLines.beginPath();
ctXLines.strokeStyle = 'black';
ctXLines.lineWidth=1.5;
ctXLines.moveTo(0, canvasHeightXLines);
ctXLines.lineTo(canvasWidthXLines, canvasHeightXLines);
for (i = 1; i <= stepsY; i++) {
  ctXLines.moveTo(0, (canvasHeightXLines - ((canvasHeightXLines / stepsY) * i)));
  ctXLines.lineTo(canvasWidthXLines, (canvasHeightXLines - ((canvasHeightXLines / stepsY) * i)));
  ctXLines.stroke();
}
ctXLines.closePath();

// Draw X-axis lines
var stepsX = 11;
ctYLines.beginPath();
ctYLines.strokeStyle = 'black';
ctYLines.lineWidth=1.5;
ctYLines.moveTo(0, 0);
ctYLines.lineTo(0, canvasHeightYLines);
for (i = 1; i <= stepsX; i++) {
  ctYLines.moveTo(0 + ((canvasWidthYLines / stepsX) * i), 0);
  ctYLines.lineTo(0 + ((canvasWidthYLines / stepsX) * i), canvasHeightYLines);
  ctYLines.stroke();
}
ctYLines.closePath();

// Initialize months
var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];

// Draw text for each month, evenly spaced out throughout the canvas
ctYText.font = "13px Arial";
var counterX = 1;
for (var month in months) {
  ctYText.fillText(months[month], ((canvasWidthYText / months.length) * counterX) - 43, (canvasHeightYText - 35));
  counterX++;
}

// Draw X-axis label
ctYText.font = "16px Arial";
ctYText.fillText("Months", (canvasWidthYText / 2) - 30, canvasHeightYText - 5);

// Initialize temps
var temps = ["-5", "0", "5", "10", "15", "20", "25"];

// Draw text for each temperature label, evenly spaced out throughout the canvas
ctXText.font = "13px Arial";
var counterY = 1;
for (var temp in temps) {
  ctXText.fillText(temps[temp], (canvasWidthXText - 20), (canvasHeightXText + 10) - (canvasHeightXText / temps.length) * counterY);
  counterY++;
}

// Draw Y-axis label
ctXText.rotate(270 * Math.PI / 180);
ctXText.font = "16px Arial";
ctXText.fillText("Temperature in degrees Celsius", (-canvasHeightXText + 70), 12);

</script>
</body>
</html>
